<div class="main-container">
  <div class="header">
    <h2>‚ú® Minhas Tarefas</h2>
    <button class="btn-primary" (click)="openCreate()">+ Nova</button>
  </div>

  <div class="controls-panel">
    <select [(ngModel)]="filterStatus" (change)="refresh()" class="control-select">
      <option value="ALL">Status: Todos</option>
      <option value="PENDING">Status: Pendentes</option>
      <option value="DONE">Status: Conclu√≠das</option>
    </select>

    <select [(ngModel)]="filterPriority" (change)="refresh()" class="control-select">
      <option value="ALL">Prioridade: Todas</option>
      <option value="LOW">Prioridade: Baixa</option>
      <option value="MEDIUM">Prioridade: M√©dia</option>
      <option value="HIGH">Prioridade: Alta</option>
    </select>

    <select [(ngModel)]="sortBy" (change)="refresh()" class="control-select">
      <option value="createdAt">Ordenar por: Data</option>
      <option value="priority">Ordenar por: Prioridade</option>
      <option value="title">Ordenar por: T√≠tulo</option>
    </select>
  </div>
  <div *ngIf="loading" class="loading-message">Carregando...</div>

  <ul *ngIf="!loading && data.items.length > 0" class="task-list">
    <li *ngFor="let t of data.items" class="task-card" [class.is-done]="t.done">
      <div class="task-details">
        <h4 class="task-title">{{ t.title }}</h4>
        <p *ngIf="t.description" class="task-description">{{ t.description }}</p>
        <div class="task-meta">
          <span class="badge priority-badge" [ngClass]="t.priority.toLowerCase()">
            {{ t.priority }}
          </span>
          <span class="badge status-badge" [ngClass]="t.done ? 'done' : 'pending'">
            {{ t.done ? 'CONCLU√çDA' : 'PENDENTE' }}
          </span>
          <small class="creation-date">
            Criado em: {{ t.createdAt | date:'short' }}
          </small>
        </div>
      </div>

      <div class="actions">
        <button
          (click)="toggleDone(t)"
          [class.btn-success]="!t.done"
          [class.btn-neutral]="t.done"
          class="action-button"
        >
          {{ t.done ? '‚Ü©Ô∏è Reabrir' : '‚úÖ Concluir' }}
        </button>

        <button (click)="editTask(t)" class="action-button btn-soft btn-edit">
          ‚úèÔ∏è Editar
        </button>
        <button (click)="confirmDelete(t)" class="action-button btn-soft btn-delete">
          üóëÔ∏è Excluir
        </button>
      </div>
    </li>
  </ul>

  <div *ngIf="!loading && data.items.length === 0" class="empty-message">
    Nenhuma tarefa encontrada.
  </div>
</div>
<app-task-form *ngIf="modalOpen" [editing]="!!editingTask" [task]="editingTask" (saved)="refresh()"
  (closed)="modalOpen = false">
</app-task-form>
